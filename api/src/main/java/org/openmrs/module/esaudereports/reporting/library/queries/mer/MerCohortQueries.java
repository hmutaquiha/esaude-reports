package org.openmrs.module.esaudereports.reporting.library.queries.mer;

/**
 * Created by Hamilton Mutaquiha on 2/15/18.
 */
public class MerCohortQueries {
	
	public static final String ART_START_IN_PERIOD = "select art_status.patient_id " + "from esaude_dw.art_status "
	        + "where art_status.first_event = true " + "and art_status.event_date >= :startDate "
	        + "and art_status.event_date <= :endDate";
	
	public static final String ART_START_IN_PERIOD_BY_AGE = "select art_status.patient_id " + "from esaude_dw.art_status "
	        + "join esaude_dw.patient on (patient.id = art_status.patient_id) " + "where art_status.first_event = true "
	        + "and art_status.event_date >= :startDate " + "and art_status.event_date <= :endDate "
	        + "and art_status.age_in_years >= :minAgeInclusive " + "and art_status.age_in_years < :maxAgeExclusive "
	/*+ "and art_status.location = :location"*/;
	
	public static final String ART_START_IN_PERIOD_BY_GENDER_AGE = "select art_status.patient_id "
	        + "from esaude_dw.art_status " + "join esaude_dw.patient on (patient.id = art_status.patient_id) "
	        + "where art_status.first_event = true " + "and art_status.event_date >= :startDate "
	        + "and art_status.event_date <= :endDate " + "and patient.sex = :gender "
	        + "and art_status.age_in_years >= :minAgeInclusive " + "and art_status.age_in_years < :maxAgeExclusive "
	/*+ "and art_status.location = :location"*/;
	
	public static final String ART_START_IN_PERIOD_PREGNANTS = "select distinct art_status.patient_id "
	        + "from esaude_dw.art_status " + "join esaude_dw.patient on (patient.id = art_status.patient_id)"
	        + "left join esaude_dw.pregnancy pregnancy_at_start on (pregnancy_at_start.patient_id = art_status.patient_id "
	        + "and pregnancy_at_start.start_date <= art_status.event_date "
	        + "and pregnancy_at_start.end_date >= art_status.event_date) "
	        + "left join esaude_dw.pregnancy pregnancy_at_end on (pregnancy_at_end.patient_id = art_status.patient_id "
	        + "and pregnancy_at_end.start_date <= :endDate " + "and pregnancy_at_end.end_date >= :endDate) "
	        + "where art_status.first_event = true " + "and art_status.event_date >= :startDate "
	        + "and art_status.event_date <= :endDate " + "and patient.sex = 'F' "
	        + "and (pregnancy_at_start.id is not null or pregnancy_at_end.id is not null) "
	/*+ "and art_status.location = :location"*/;
	
	public static final String ART_START_IN_PERIOD_BREASTFEEDINGS = "select distinct art_status.patient_id "
	        + "from esaude_dw.art_status "
	        + "join esaude_dw.patient on (patient.id = art_status.patient_id) "
	        + "left join esaude_dw.pregnancy pregnancy_at_start on (pregnancy_at_start.patient_id = art_status.patient_id "
	        + "and pregnancy_at_start.start_date <= art_status.event_date "
	        + "and pregnancy_at_start.end_date >= art_status.event_date) "
	        + "left join esaude_dw.pregnancy pregnancy_at_end on (pregnancy_at_end.patient_id = art_status.patient_id "
	        + "and pregnancy_at_end.start_date <= :endDate "
	        + "and pregnancy_at_end.end_date >= :endDate) "
	        + "left join esaude_dw.pregnancy breastfeeding_at_start on (breastfeeding_at_start.patient_id = art_status.patient_id "
	        + "and breastfeeding_at_start.breastfeeding_start_date <= art_status.event_date "
	        + "and breastfeeding_at_start.breastfeeding_end_date >= art_status.event_date) "
	        + "left join esaude_dw.pregnancy breastfeeding_at_end on (breastfeeding_at_end.patient_id = art_status.patient_id "
	        + "and breastfeeding_at_end.start_date <= :endDate " + "and breastfeeding_at_end.end_date >= :endDate) "
	        + "where art_status.first_event = true " + "and art_status.event_date >= :startDate "
	        + "and art_status.event_date <= :endDate " + "and patient.sex = 'F' " + "and pregnancy_at_start.id is null "
	        + "and pregnancy_at_end.id is null "
	        + "and (breastfeeding_at_start.id is not null or breastfeeding_at_end.id is not null) "
	/*+ "and art_status.location = :location"*/;
	
	public static final String ART_START_IN_PERIOD_WITH_TB = "select art_status.patient_id " + "from esaude_dw.art_status "
	        + "where art_status.first_event = true " + "and art_status.event_date >= :startDate "
	        + "and art_status.event_date <= :endDate " + "and exists (select * from esaude_dw.tb_treatment "
	        + "               where tb_treatment.patient_id = art_status.patient_id "
	        + "               and tb_treatment.date between :startDate and :endDate)";
	
	public static final String IN_TREATMENT_IN_PERIOD = "select distinct art_status.patient_id "
	        + "from esaude_dw.art_status "
	        + "join (select max(art_status.event_date) last_event_date, art_status.patient_id from esaude_dw.art_status "
	        + "		where art_status.event_date between :startDate and :endDate "
	        + "		group by art_status.patient_id) last_events on ( " + "			last_events.patient_id = art_status.patient_id "
	        + "			and last_events.last_event_date = art_status.event_date) " + "where art_status.status = 'ACTIVE'";
	
	public static final String IN_TREATMENT_IN_PERIOD_BY_AGE = "select distinct art_status.patient_id "
	        + "from esaude_dw.art_status "
	        + "join (select max(art_status.event_date) last_event_date, art_status.patient_id from esaude_dw.art_status "
	        + "		where art_status.event_date between :startDate and :endDate "
	        + "		group by art_status.patient_id) last_events on ( " + "			last_events.patient_id = art_status.patient_id "
	        + "			and last_events.last_event_date = art_status.event_date) " + "where art_status.status = 'ACTIVE' "
	        + "and art_status.age_in_years >= :minAgeInclusive " + "and art_status.age_in_years < :maxAgeExclusive";
	
	public static final String IN_TREATMENT_IN_PERIOD_BY_AGE_AND_GENDER = "select distinct art_status.patient_id "
	        + "from esaude_dw.art_status "
	        + "join (select max(art_status.event_date) last_event_date, art_status.patient_id from esaude_dw.art_status "
	        + "		where art_status.event_date between :startDate and :endDate "
	        + "		group by art_status.patient_id) last_events on ( " + "			last_events.patient_id = art_status.patient_id "
	        + "			and last_events.last_event_date = art_status.event_date) "
	        + "join esaude_dw.patient on (patient.id = art_status.patient_id) " + "where art_status.status = 'ACTIVE' "
	        + "and art_status.age_in_years >= :minAgeInclusive " + "and art_status.age_in_years < :maxAgeExclusive "
	        + "and patient.sex = :gender";
	
	public static final String ART_START_IN_PERIOD_RETENTION = "select distinct art_status.patient_id "
	        + "from esaude_dw.art_status "
	        + "join esaude_dw.art_status last_active_status on (last_active_status.patient_id = art_status.patient_id "
	        + "and last_active_status.event_date = "
	        + "		(select max(event_date) from esaude_dw.art_status ars where ars.patient_id = art_status.patient_id "
	        + "			and ars.event_date >= art_status.event_date and ars.event_date <= date_add(art_status.event_date, interval :months month)) "
	        + "and not (last_active_status.status = 'ABANDON' and last_active_status.event = 'TRANSFER')) "
	        + "where art_status.first_event = true "
	        + "and art_status.event_date >= esaude_dw.inclusion_start_date_from_retention(:endDate, :months) "
	        + "and art_status.event_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months)";
	
	public static final String ART_START_IN_PERIOD_BY_AGE_RETENTION = "select distinct art_status.patient_id "
	        + "from esaude_dw.art_status "
	        + "join esaude_dw.art_status last_active_status on (last_active_status.patient_id = art_status.patient_id  "
	        + "	and last_active_status.event_date =  "
	        + "		(select max(event_date) from esaude_dw.art_status ars where ars.patient_id = art_status.patient_id  "
	        + "			and ars.event_date >= art_status.event_date and ars.event_date <= date_add(art_status.event_date, interval :months month)) "
	        + "	and not (last_active_status.status = 'ABANDON' and last_active_status.event = 'TRANSFER')) "
	        + "where art_status.first_event = true "
	        + "and art_status.event_date >= esaude_dw.inclusion_start_date_from_retention(:endDate, :months) "
	        + "and art_status.event_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "and art_status.age_in_years >= :minAgeInclusive " + "and art_status.age_in_years < :maxAgeExclusive";
	
	public static final String ART_START_IN_PERIOD_BY_AGE_AND_GENDER_RETENTION = "select distinct art_status.patient_id "
	        + "from esaude_dw.art_status "
	        + "join esaude_dw.art_status last_active_status on (last_active_status.patient_id = art_status.patient_id "
	        + "	and last_active_status.event_date =  "
	        + "		(select max(event_date) from esaude_dw.art_status ars where ars.patient_id = art_status.patient_id  "
	        + "			and ars.event_date >= art_status.event_date and ars.event_date <= date_add(art_status.event_date, interval :months month)) "
	        + "	and not (last_active_status.status = 'ABANDON' and last_active_status.event = 'TRANSFER')) "
	        + "join esaude_dw.patient on (patient.id = art_status.patient_id) " + "where art_status.first_event = true "
	        + "and art_status.event_date >= esaude_dw.inclusion_start_date_from_retention(:endDate, :months) "
	        + "and art_status.event_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "and art_status.age_in_years >= :minAgeInclusive " + "and art_status.age_in_years < :maxAgeExclusive "
	        + "and patient.sex = :gender ";
	
	public static final String ART_START_IN_PERIOD_PREGNANTS_RETENTION = "select distinct art_status.patient_id "
	        + "from esaude_dw.art_status "
	        + "join esaude_dw.art_status last_active_status on (last_active_status.patient_id = art_status.patient_id  "
	        + "	and last_active_status.event_date =  "
	        + "		(select max(event_date) from esaude_dw.art_status ars where ars.patient_id = art_status.patient_id  "
	        + "			and ars.event_date >= art_status.event_date and ars.event_date <= date_add(art_status.event_date, interval :months month)) "
	        + "	and not (last_active_status.status = 'ABANDON' and last_active_status.event = 'TRANSFER')) "
	        + "join esaude_dw.patient on (patient.id = art_status.patient_id) "
	        + "left join esaude_dw.pregnancy pregnancy_at_start on (pregnancy_at_start.patient_id = art_status.patient_id and pregnancy_at_start.start_date <= art_status.event_date and pregnancy_at_start.end_date >= art_status.event_date) "
	        + "left join esaude_dw.pregnancy pregnancy_at_end on (pregnancy_at_end.patient_id = art_status.patient_id and pregnancy_at_end.start_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) and pregnancy_at_end.end_date >= esaude_dw.inclusion_end_date_from_retention(:endDate, :months)) "
	        + "where art_status.first_event = true "
	        + "and art_status.event_date >= esaude_dw.inclusion_start_date_from_retention(:endDate, :months) "
	        + "and art_status.event_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "and patient.sex = 'F' " + "and (pregnancy_at_start.id is not null or pregnancy_at_end.id is not null)";
	
	public static final String ART_START_IN_PERIOD_BREASTFEEDINGS_RETENTION = "select distinct art_status.patient_id  "
	        + "from esaude_dw.art_status "
	        + "join esaude_dw.art_status last_active_status on (last_active_status.patient_id = art_status.patient_id  "
	        + "	and last_active_status.event_date =  "
	        + "		(select max(event_date) from esaude_dw.art_status ars where ars.patient_id = art_status.patient_id  "
	        + "			and ars.event_date >= art_status.event_date and ars.event_date <= date_add(art_status.event_date, interval :months month)) "
	        + "	and not (last_active_status.status = 'ABANDON' and last_active_status.event = 'TRANSFER')) "
	        + "join esaude_dw.patient on (patient.id = art_status.patient_id) "
	        + "left join esaude_dw.pregnancy pregnancy_at_start on (pregnancy_at_start.patient_id = art_status.patient_id  "
	        + "	and pregnancy_at_start.start_date <= art_status.event_date  "
	        + "	and pregnancy_at_start.end_date >= art_status.event_date) "
	        + "left join esaude_dw.pregnancy pregnancy_at_end on (pregnancy_at_end.patient_id = art_status.patient_id  "
	        + "	and pregnancy_at_end.start_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "	and pregnancy_at_end.end_date >= esaude_dw.inclusion_end_date_from_retention(:endDate, :months)) "
	        + "left join esaude_dw.pregnancy breastfeeding_at_start on (breastfeeding_at_start.patient_id = art_status.patient_id  "
	        + "	and breastfeeding_at_start.breastfeeding_start_date <= art_status.event_date  "
	        + "	and breastfeeding_at_start.breastfeeding_end_date >= art_status.event_date) "
	        + "left join esaude_dw.pregnancy breastfeeding_at_end on (breastfeeding_at_end.patient_id = art_status.patient_id  "
	        + "	and breastfeeding_at_end.start_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "	and breastfeeding_at_end.end_date >= esaude_dw.inclusion_end_date_from_retention(:endDate, :months)) "
	        + "where art_status.first_event = true "
	        + "and art_status.event_date >= esaude_dw.inclusion_start_date_from_retention(:endDate, :months) "
	        + "and art_status.event_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "and patient.sex = 'F' " + "and pregnancy_at_start.id is null " + "and pregnancy_at_end.id is null "
	        + "and (breastfeeding_at_start.id is not null or breastfeeding_at_end.id is not null)";
	
	public static final String IN_TREATMENT_IN_PERIOD_RETENTION = "select distinct art_status.patient_id from esaude_dw.art_status "
	        + "join esaude_dw.art_status last_active_status on (last_active_status.patient_id = art_status.patient_id "
	        + "	and last_active_status.event_date = "
	        + "		(select max(event_date) from esaude_dw.art_status ars where ars.patient_id = art_status.patient_id "
	        + "			and ars.event_date >= art_status.event_date and ars.event_date <= date_add(art_status.event_date, interval :months month)) "
	        + "	and last_active_status.status = 'ACTIVE') "
	        + "where art_status.first_event = true "
	        + "and art_status.event_date >= esaude_dw.inclusion_start_date_from_retention(:endDate, :months) "
	        + "and art_status.event_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months)";
	
	public static final String IN_TREATMENT_IN_PERIOD_BY_AGE_RETENTION = "select distinct art_status.patient_id from esaude_dw.art_status "
	        + "join esaude_dw.art_status last_active_status on (last_active_status.patient_id = art_status.patient_id "
	        + "	and last_active_status.event_date =  "
	        + "		(select max(event_date) from esaude_dw.art_status ars where ars.patient_id = art_status.patient_id "
	        + "			and ars.event_date >= art_status.event_date and ars.event_date <= date_add(art_status.event_date, interval :months month)) "
	        + "	and last_active_status.status = 'ACTIVE') "
	        + "where art_status.first_event = true "
	        + "and art_status.event_date >= esaude_dw.inclusion_start_date_from_retention(:endDate, :months) "
	        + "and art_status.event_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "and art_status.age_in_years >= :minAgeInclusive " + "and art_status.age_in_years < :maxAgeExclusive";
	
	public static final String IN_TREATMENT_IN_PERIOD_BY_AGE_AND_GENDER_RETENTION = "select distinct art_status.patient_id from esaude_dw.art_status "
	        + "join esaude_dw.art_status last_active_status on (last_active_status.patient_id = art_status.patient_id "
	        + "	and last_active_status.event_date = "
	        + "		(select max(event_date) from esaude_dw.art_status ars where ars.patient_id = art_status.patient_id "
	        + "			and ars.event_date >= art_status.event_date and ars.event_date <= date_add(art_status.event_date, interval :months month)) "
	        + "	and last_active_status.status = 'ACTIVE') "
	        + "join esaude_dw.patient on (patient.id = art_status.patient_id) "
	        + "where art_status.first_event = true "
	        + "and art_status.event_date >= esaude_dw.inclusion_start_date_from_retention(:endDate, :months) "
	        + "and art_status.event_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "and art_status.age_in_years >= :minAgeInclusive "
	        + "and art_status.age_in_years < :maxAgeExclusive "
	        + "and patient.sex = :gender";
	
	public static final String IN_TREATMENT_IN_PERIOD_PREGNANTS_RETENTION = "select distinct art_status.patient_id from esaude_dw.art_status "
	        + "join esaude_dw.art_status last_active_status on (last_active_status.patient_id = art_status.patient_id "
	        + "	and last_active_status.event_date = "
	        + "		(select max(event_date) from esaude_dw.art_status ars where ars.patient_id = art_status.patient_id "
	        + "			and ars.event_date >= art_status.event_date and ars.event_date <= date_add(art_status.event_date, interval :months month)) "
	        + "	and last_active_status.status = 'ACTIVE') "
	        + "join esaude_dw.patient on (patient.id = art_status.patient_id) "
	        + "left join esaude_dw.pregnancy pregnancy_at_start on (pregnancy_at_start.patient_id = art_status.patient_id "
	        + "	and pregnancy_at_start.start_date <= art_status.event_date and pregnancy_at_start.end_date >= art_status.event_date) "
	        + "left join esaude_dw.pregnancy pregnancy_at_end on (pregnancy_at_end.patient_id = art_status.patient_id "
	        + "	and pregnancy_at_end.start_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "	and pregnancy_at_end.end_date >= esaude_dw.inclusion_end_date_from_retention(:endDate, :months)) "
	        + "where art_status.first_event = true "
	        + "and art_status.event_date >= esaude_dw.inclusion_start_date_from_retention(:endDate, :months) "
	        + "and art_status.event_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "and patient.sex = 'F' "
	        + "and (pregnancy_at_start.id is not null or pregnancy_at_end.id is not null) "
	        + "and patient.sex = 'F' " + "and (pregnancy_at_start.id is not null or pregnancy_at_end.id is not null)";
	
	public static final String IN_TREATMENT_IN_PERIOD_BREASTFEEDINGS_RETENTION = "select distinct art_status.patient_id from esaude_dw.art_status "
	        + "join esaude_dw.art_status last_active_status on (last_active_status.patient_id = art_status.patient_id "
	        + "	and last_active_status.event_date = "
	        + "		(select max(event_date) from esaude_dw.art_status ars where ars.patient_id = art_status.patient_id "
	        + "			and ars.event_date >= art_status.event_date and ars.event_date <= date_add(art_status.event_date, interval :months month)) "
	        + "	and last_active_status.status = 'ACTIVE') "
	        + "join esaude_dw.patient on (patient.id = art_status.patient_id) "
	        + "left join esaude_dw.pregnancy pregnancy_at_start on (pregnancy_at_start.patient_id = art_status.patient_id "
	        + "	and pregnancy_at_start.start_date <= art_status.event_date "
	        + "	and pregnancy_at_start.end_date >= art_status.event_date) "
	        + "left join esaude_dw.pregnancy pregnancy_at_end on (pregnancy_at_end.patient_id = art_status.patient_id "
	        + "	and pregnancy_at_end.start_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "	and pregnancy_at_end.end_date >= esaude_dw.inclusion_end_date_from_retention(:endDate, :months)) "
	        + "left join esaude_dw.pregnancy breastfeeding_at_start on (breastfeeding_at_start.patient_id = art_status.patient_id "
	        + "	and breastfeeding_at_start.breastfeeding_start_date <= art_status.event_date "
	        + "	and breastfeeding_at_start.breastfeeding_end_date >= art_status.event_date) "
	        + "left join esaude_dw.pregnancy breastfeeding_at_end on (breastfeeding_at_end.patient_id = art_status.patient_id "
	        + "	and breastfeeding_at_end.start_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "	and breastfeeding_at_end.end_date >= esaude_dw.inclusion_end_date_from_retention(:endDate, :months)) "
	        + "where art_status.first_event = true "
	        + "and art_status.event_date >= esaude_dw.inclusion_start_date_from_retention(:endDate, :months) "
	        + "and art_status.event_date <= esaude_dw.inclusion_end_date_from_retention(:endDate, :months) "
	        + "and patient.sex = 'F' "
	        + "and pregnancy_at_start.id is null "
	        + "and pregnancy_at_end.id is null "
	        + "and (breastfeeding_at_start.id is not null or breastfeeding_at_end.id is not null)";
	
	public static final String PATIENTS_WITH_REPORTED_VIRAL_LOAD_LAST_12_MONTHS = "select distinct viral_load.patient_id "
	        + "from esaude_dw.viral_load "
	        + "join (select viral_load.patient_id, max(viral_load.date) date from esaude_dw.viral_load "
	        + "		where viral_load.date between date_add(:endDate, interval -12 month) and :endDate "
	        + "		group by viral_load.patient_id) most_recent_viral_load on ( "
	        + "			most_recent_viral_load.patient_id = viral_load.patient_id "
	        + "			and most_recent_viral_load.date = viral_load.date)";
	
	public static final String PATIENTS_WITH_REPORTED_VIRAL_LOAD_LAST_12_MONTHS_BY_AGE = "select distinct viral_load.patient_id "
	        + "from esaude_dw.viral_load "
	        + "join (select viral_load.patient_id, max(viral_load.date) date from esaude_dw.viral_load "
	        + "		where viral_load.date between date_add(:endDate, interval -12 month) and :endDate "
	        + "		group by viral_load.patient_id) most_recent_viral_load on ( "
	        + "			most_recent_viral_load.patient_id = viral_load.patient_id "
	        + "			and most_recent_viral_load.date = viral_load.date) "
	        + "where viral_load.age_in_years >= :minAgeInclusive " + "and viral_load.age_in_years < :maxAgeExclusive";
	
	public static final String PATIENTS_WITH_REPORTED_VIRAL_LOAD_LAST_12_MONTHS_BY_AGE_AND_GENDER = "select distinct viral_load.patient_id "
	        + "from esaude_dw.viral_load "
	        + "join (select viral_load.patient_id, max(viral_load.date) date from esaude_dw.viral_load "
	        + "		where viral_load.date between date_add(:endDate, interval -12 month) and :endDate "
	        + "		group by viral_load.patient_id) most_recent_viral_load on ( "
	        + "			most_recent_viral_load.patient_id = viral_load.patient_id "
	        + "			and most_recent_viral_load.date = viral_load.date) "
	        + "join esaude_dw.patient on (patient.id = viral_load.patient_id) "
	        + "where viral_load.age_in_years >= :minAgeInclusive "
	        + "and viral_load.age_in_years < :maxAgeExclusive "
	        + "and patient.sex = :gender";
	
	public static final String PATIENTS_WITH_REPORTED_VIRAL_LOAD_LAST_12_MONTHS_PREGNANTS = "select distinct viral_load.patient_id "
	        + "from esaude_dw.viral_load "
	        + "join (select viral_load.patient_id, max(viral_load.date) date from esaude_dw.viral_load "
	        + "		where viral_load.date between date_add(:endDate, interval -12 month) and :endDate "
	        + "		group by viral_load.patient_id) most_recent_viral_load on ( "
	        + "			most_recent_viral_load.patient_id = viral_load.patient_id "
	        + "			and most_recent_viral_load.date = viral_load.date) "
	        + "left join esaude_dw.pregnancy pregnancy_at_start on (pregnancy_at_start.patient_id = viral_load.patient_id "
	        + "	and pregnancy_at_start.start_date <= date_add(:endDate, interval -12 month) "
	        + "	and pregnancy_at_start.end_date >= date_add(:endDate, interval -12 month)) "
	        + "left join esaude_dw.pregnancy pregnancy_at_end on (pregnancy_at_end.patient_id = viral_load.patient_id  "
	        + "	and pregnancy_at_end.start_date <= :endDate "
	        + "	and pregnancy_at_end.end_date >= :endDate) "
	        + "where (pregnancy_at_start.id is not null or pregnancy_at_end.id is not null)";
	
	public static final String PATIENTS_WITH_REPORTED_VIRAL_LOAD_LAST_12_MONTHS_BREASTFEEDINGS = "select distinct viral_load.patient_id "
	        + "from esaude_dw.viral_load "
	        + "join (select viral_load.patient_id, max(viral_load.date) date from esaude_dw.viral_load "
	        + "		where viral_load.date between date_add(:endDate, interval -12 month) and :endDate "
	        + "		group by viral_load.patient_id) most_recent_viral_load on ( "
	        + "			most_recent_viral_load.patient_id = viral_load.patient_id "
	        + "			and most_recent_viral_load.date = viral_load.date) "
	        + "left join esaude_dw.pregnancy pregnancy_at_start on (pregnancy_at_start.patient_id = viral_load.patient_id "
	        + "	and pregnancy_at_start.start_date <= date_add(:endDate, interval -12 month) "
	        + "	and pregnancy_at_start.end_date >= date_add(:endDate, interval -12 month)) "
	        + "left join esaude_dw.pregnancy pregnancy_at_end on (pregnancy_at_end.patient_id = viral_load.patient_id "
	        + "	and pregnancy_at_end.start_date <= :endDate "
	        + "	and pregnancy_at_end.end_date >= :endDate) "
	        + "left join esaude_dw.pregnancy breastfeeding_at_start on (breastfeeding_at_start.patient_id = viral_load.patient_id "
	        + "	and breastfeeding_at_start.breastfeeding_start_date <= date_add(:endDate, interval -12 month) "
	        + "	and breastfeeding_at_start.breastfeeding_end_date >= date_add(:endDate, interval -12 month)) "
	        + "left join esaude_dw.pregnancy breastfeeding_at_end on (breastfeeding_at_end.patient_id = viral_load.patient_id "
	        + "	and breastfeeding_at_end.start_date <= :endDate "
	        + "	and breastfeeding_at_end.end_date >= :endDate) "
	        + "where pregnancy_at_start.id is null "
	        + "and pregnancy_at_end.id is null "
	        + "and (breastfeeding_at_start.id is not null or breastfeeding_at_end.id is not null)";
	
	public static final String PATIENTS_WITH_UNDETECTABLE_VIRAL_LOAD_LAST_12_MONTHS = "select distinct viral_load.patient_id "
	        + "from esaude_dw.viral_load "
	        + "join (select viral_load.patient_id, max(viral_load.date) date from esaude_dw.viral_load "
	        + "		where viral_load.date between date_add(:endDate, interval -12 month) and :endDate "
	        + "		group by viral_load.patient_id) most_recent_viral_load on ( "
	        + "			most_recent_viral_load.patient_id = viral_load.patient_id "
	        + "			and most_recent_viral_load.date = viral_load.date) " + "where viral_load.value < 1000";
	
	public static final String PATIENTS_WITH_UNDETECTABLE_VIRAL_LOAD_LAST_12_MONTHS_BY_AGE = "select distinct viral_load.patient_id "
	        + "from esaude_dw.viral_load "
	        + "join (select viral_load.patient_id, max(viral_load.date) date from esaude_dw.viral_load "
	        + "		where viral_load.date between date_add(:endDate, interval -12 month) and :endDate "
	        + "		group by viral_load.patient_id) most_recent_viral_load on ( "
	        + "			most_recent_viral_load.patient_id = viral_load.patient_id "
	        + "			and most_recent_viral_load.date = viral_load.date) "
	        + "where viral_load.value < 1000 "
	        + "and viral_load.age_in_years >= :minAgeInclusive " + "and viral_load.age_in_years < :maxAgeExclusive";
	
	public static final String PATIENTS_WITH_UNDETECTABLE_VIRAL_LOAD_LAST_12_MONTHS_BY_AGE_AND_GENDER = "select distinct viral_load.patient_id "
	        + "from esaude_dw.viral_load "
	        + "join (select viral_load.patient_id, max(viral_load.date) date from esaude_dw.viral_load "
	        + "		where viral_load.date between date_add(:endDate, interval -12 month) and :endDate "
	        + "		group by viral_load.patient_id) most_recent_viral_load on ( "
	        + "			most_recent_viral_load.patient_id = viral_load.patient_id "
	        + "			and most_recent_viral_load.date = viral_load.date) "
	        + "join esaude_dw.patient on (patient.id = viral_load.patient_id) "
	        + "where viral_load.value < 1000 "
	        + "and viral_load.age_in_years >= :minAgeInclusive "
	        + "and viral_load.age_in_years < :maxAgeExclusive "
	        + "and patient.sex = :gender";
	
	public static final String PATIENTS_WITH_UNDETECTABLE_VIRAL_LOAD_LAST_12_MONTHS_PREGNANTS = "select distinct viral_load.patient_id from esaude_dw.viral_load "
	        + "join (select viral_load.patient_id, max(viral_load.date) date from esaude_dw.viral_load "
	        + "		where viral_load.date between date_add(:endDate, interval -12 month) and :endDate "
	        + "		group by viral_load.patient_id) most_recent_viral_load on ( "
	        + "			most_recent_viral_load.patient_id = viral_load.patient_id "
	        + "			and most_recent_viral_load.date = viral_load.date) "
	        + "left join esaude_dw.pregnancy pregnancy_at_start on (pregnancy_at_start.patient_id = viral_load.patient_id "
	        + "	and pregnancy_at_start.start_date <= date_add(:endDate, interval -12 month)  "
	        + "	and pregnancy_at_start.end_date >= date_add(:endDate, interval -12 month)) "
	        + "left join esaude_dw.pregnancy pregnancy_at_end on (pregnancy_at_end.patient_id = viral_load.patient_id "
	        + "	and pregnancy_at_end.start_date <= :endDate "
	        + "	and pregnancy_at_end.end_date >= :endDate) "
	        + "left join esaude_dw.pregnancy breastfeeding_at_start on (breastfeeding_at_start.patient_id = viral_load.patient_id "
	        + "	and breastfeeding_at_start.breastfeeding_start_date <= date_add(:endDate, interval -12 month) "
	        + "	and breastfeeding_at_start.breastfeeding_end_date >= date_add(:endDate, interval -12 month)) "
	        + "left join esaude_dw.pregnancy breastfeeding_at_end on (breastfeeding_at_end.patient_id = viral_load.patient_id "
	        + "	and breastfeeding_at_end.start_date <= :endDate "
	        + "	and breastfeeding_at_end.end_date >= :endDate) "
	        + "where viral_load.value < 1000 "
	        + "and pregnancy_at_start.id is null "
	        + "and pregnancy_at_end.id is null "
	        + "and (breastfeeding_at_start.id is not null or breastfeeding_at_end.id is not null)";
	
	public static final String PATIENTS_WITH_UNDETECTABLE_VIRAL_LOAD_LAST_12_MONTHS_BREASTFEEDINGS = "select distinct viral_load.patient_id "
	        + "from esaude_dw.viral_load "
	        + "join (select viral_load.patient_id, max(viral_load.date) date from esaude_dw.viral_load "
	        + "		where viral_load.date between date_add(:endDate, interval -12 month) and :endDate "
	        + "		group by viral_load.patient_id) most_recent_viral_load on ( "
	        + "			most_recent_viral_load.patient_id = viral_load.patient_id "
	        + "			and most_recent_viral_load.date = viral_load.date) "
	        + "left join esaude_dw.pregnancy pregnancy_at_start on (pregnancy_at_start.patient_id = viral_load.patient_id "
	        + "	and pregnancy_at_start.start_date <= date_add(:endDate, interval -12 month) "
	        + "	and pregnancy_at_start.end_date >= date_add(:endDate, interval -12 month)) "
	        + "left join esaude_dw.pregnancy pregnancy_at_end on (pregnancy_at_end.patient_id = viral_load.patient_id "
	        + "	and pregnancy_at_end.start_date <= :endDate "
	        + "	and pregnancy_at_end.end_date >= :endDate) "
	        + "where viral_load.value < 1000 "
	        + "and (pregnancy_at_start.id is not null or pregnancy_at_end.id is not null)";
}
